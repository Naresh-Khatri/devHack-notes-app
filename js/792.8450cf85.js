"use strict";(self["webpackChunkd2c_notes_frontend"]=self["webpackChunkd2c_notes_frontend"]||[]).push([[792],{4792:(e,t,a)=>{a.r(t),a.d(t,{default:()=>W});var s=a(3673),n=a(8880),l=a(2323);const o={class:"bg-gr ey-3"},i={class:"top-left-btn"},r={class:"date",style:{width:"100vw",position:"absolute",display:"flex","justify-content":"center","align-items":"center","z-index":"10","margin-top":"15px"}},u={key:0},c=["onClick","src"];function g(e,t,a,g,d,m){const p=(0,s.up)("q-btn"),v=(0,s.up)("q-chip"),h=(0,s.up)("q-chat-message"),w=(0,s.up)("q-spinner-dots"),y=(0,s.up)("q-scroll-area"),D=(0,s.up)("q-badge"),f=(0,s.up)("q-page-sticky"),b=(0,s.up)("q-input"),M=(0,s.up)("q-page"),k=(0,s.Q2)("intersection");return(0,s.wg)(),(0,s.iD)("div",o,[(0,s.Wm)(M,{class:"flex justify-center bg-white",style:{width:"60%","border-radius":"40px",margin:"0 auto"}},{default:(0,s.w5)((()=>[(0,s._)("div",i,[(0,s.Wm)(p,{class:"absolute",color:"primary",style:{background:"white",width:"60px",height:"60px","z-index":"10"},flat:"",dense:"",round:"",icon:"arrow_back_ios","aria-label":"Menu",onClick:t[0]||(t[0]=t=>e.$router.push("/"))})]),(0,s._)("div",r,[(0,s.Wm)(n.uT,{name:"slide-fade"},{default:(0,s.w5)((()=>[g.canShowTopDate?((0,s.wg)(),(0,s.iD)("div",u,[(0,s.Wm)(v,{color:"secondary",ref:"DateBox","text-color":"white",size:"17px"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(g.topMsgDate),1)])),_:1},512)])):(0,s.kq)("",!0)])),_:1})]),(0,s.Wm)(y,{onScroll:g.showTopDate,ref:"scrollArea",class:"absolute-full",style:{height:"90%"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(g.getMsgsData,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t},[(0,s._)("div",null,[0===t?((0,s.wg)(),(0,s.j4)(h,{key:0,label:g.getDatestamp(e.timestamp)},null,8,["label"])):g.getDate(e.timestamp)!=g.getDate(g.getMsgsData[0==t?0:t-1].timestamp)?((0,s.wg)(),(0,s.j4)(h,{key:1,label:g.getDatestamp(e.timestamp)},null,8,["label"])):(0,s.kq)("",!0)]),0!=t?((0,s.wg)(),(0,s.j4)(n.uT,{key:0,appear:"","enter-active-class":`animated ${g.isOwner(e.user)?"slideInRight":"slideInLeft"} `},{default:(0,s.w5)((()=>[(0,s.wy)(((0,s.wg)(),(0,s.j4)(h,{key:t,"data-id":t,sent:g.isOwner(e.user),class:(0,l.C_)(["q-mx-sm text-white",(e.text.length,"text-h6")]),name:g.getMsgsData[t-1].user!=e.user||g.getDate(e.timestamp)!=g.getDate(g.getMsgsData[0==t?0:t-1].timestamp)?`<span class='text-black'>${e.name}</span>`:"","name-html":"",text:[e.text],stamp:g.getTimestamp(e.timestamp)},{avatar:(0,s.w5)((()=>[(0,s._)("img",{onClick:t=>g.handleProfileShow(e.user),style:{cursor:"pointer"},class:"q-mx-sm q-message-avatar q-message-avatar--sent",src:g.getMsgPhotoURL(e.user)||"https://cdn.quasar.dev/img/avatar1.jpg"},null,8,c)])),_:2},1032,["data-id","sent","class","name","text","stamp"])),[[k,g.onChatMessageIntersection]])])),_:2},1032,["enter-active-class"])):(0,s.kq)("",!0)])))),128)),(0,s.Wm)(n.W3,{appear:"","enter-active-class":"animated slideInLeft","leave-active-class":"animated fadeOut"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(g.getTypingUsers,((e,t)=>((0,s.wg)(),(0,s.j4)(h,{key:t,name:e.username,avatar:e.photoURL||"https://cdn.quasar.dev/img/avatar1.jpg","bg-color":"amber"},{default:(0,s.w5)((()=>[(0,s.Wm)(w,{size:"2rem"})])),_:2},1032,["name","avatar"])))),128))])),_:1})])),_:1},8,["onScroll"]),(0,s.Wm)(f,{position:"bottom-right",offset:[18,88]},{default:(0,s.w5)((()=>[(0,s.Wm)(n.uT,{appear:"","enter-active-class":"animated slideInUp"},{default:(0,s.w5)((()=>[g.unreadChatCount?((0,s.wg)(),(0,s.j4)(p,{key:0,onClick:g.scrollBottom,round:"",icon:"expand_more",color:"primary"},{default:(0,s.w5)((()=>[(0,s.Wm)(D,{rounded:"",color:"orange",floating:""},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(g.unreadChatCount),1)])),_:1})])),_:1},8,["onClick"])):(0,s.kq)("",!0)])),_:1})])),_:1}),(0,s.Wm)(b,{filled:"",rounded:"",modelValue:g.msgText,"onUpdate:modelValue":t[1]||(t[1]=e=>g.msgText=e),placeholder:"Type a message",onKeydown:[(0,n.D2)(g.sendMsg,["enter"]),g.debounceSendMsg],class:"absolute-bottom q-ma-md"},{after:(0,s.w5)((()=>[(0,s.Wm)(p,{round:"",dense:"",flat:"",color:"green",icon:"send",onClick:g.sendMsg},null,8,["onClick"])])),_:1},8,["modelValue","onKeydown"])])),_:1})])}var d=a(3396),m=a(5474),p=a(1959),v=a(3617),h=a(9582),w=(a(8506),a(5335)),y=a(8825),D=a(3308);const f={setup(){const e=(0,v.oR)(),t=(0,h.tv)(),a=(0,y.Z)(),n=(0,p.iH)(""),l=(0,p.iH)(3),o=(0,p.iH)(null),i=(0,p.iH)(null),r=(0,p.iH)(!1),u=(0,p.iH)(null),c=(0,p.iH)(null),g=(0,p.iH)([]),f=(0,p.iH)(null),b=(0,p.iH)(!1),M=(0,s.Fl)((()=>e.state.msgsData)),k=(0,s.Fl)((()=>e.state.typingUsers)),x=(0,s.Fl)((()=>e.state.userData.uid)),S=(0,s.Fl)((()=>e.state.userData.name)),_=(0,s.Fl)((()=>e.state.userData.photoURL));(0,s.bv)((()=>{r.value=!0,o.value=(0,d.ZP)(D.q),o.value.on("connect",(()=>{console.log("conneted to ws - "+o.value.id),a.loading.isActive&&(a.notify({message:"âœ… Connected to server ðŸ˜Ž",color:"primary",position:"top",timeout:2e3}),a.loading.hide())})),o.value.on("disconnect",(()=>{console.log("disconneted from ws"),a.loading.show({message:"Reconeccting to server...",boxClass:"bg-grey-2 text-grey-9",spinner:w.Z,spinnerColor:"primary"})})),o.value.on("receivePrevMsgsData",(t=>{e.commit("updateMsgsData",t),setTimeout((()=>{H()}),500)})),o.value.on("typing",(t=>{e.dispatch("updateTypingUsers",t),H()})),o.value.on("receiveMsg",(t=>{e.dispatch("updateTypingUsers",{uid:t.user,typing:!1}),e.commit("appendNewMsgData",t),l.value++;const a=c.value.getScroll().verticalSize-c.value.getScroll().verticalPosition;a<800&&H()}))}));const C=e=>new Date(e).getDate(),q=()=>{const e={uid:x.value,username:S.value,photoURL:_.value};b.value||(console.log("emitting typing"),o.value.emit("typing",Object.assign(e,{typing:!0}))),b.value=!0,clearTimeout(f.value),f.value=setTimeout((()=>{b.value=!1,o.value.emit("typing",Object.assign(e,{typing:!1}))}),2e3)},T=e=>e==x.value,U=e=>D.O+"/user/photoURL/"+e,Z=async e=>{try{await m.api.post("/user/userData",{uid:e});t.push({name:"profile-viewer",query:{uid:e}})}catch(s){a.notify({message:"âŒ Error fetching user data",color:"red",position:"top-right",timeout:2e3})}},j=()=>{if(!x.value)return void a.dialog({title:"Login Required",message:"Please login to send message",ok:"Login",cancel:"Cancel",persistent:!0}).onOk((()=>{t.push("/signup")})).onCancel((()=>{t.push("/")}));if(""==n.value)return;r.value=!r.value;const s={user:x.value,name:S.value,photoURL:_.value,text:[n.value]};o.value.emit("sendMsg",s),e.commit("appendNewMsgData",Object.assign(s,{timestamp:(new Date).toISOString()})),H(),n.value=""},H=()=>{c.value&&(c.value.setScrollPosition("vertical",c.value.getScroll().verticalSize,400),l.value=0)},O=()=>{71.9*M.value.length<c.value.getScroll().verticalSize?l.value++:c.value.setScrollPosition("vertical",c.value.scrollSize,400)},P=()=>{r.value=!0,clearTimeout(u.value),u.value=setTimeout((()=>{r.value=!1}),1500)},W=e=>{e.isIntersecting?g.value.push(e.target.dataset.id):g.value.splice(g.value.indexOf(e.target.dataset.id),1),g.value.sort();const t=g.value[0];if(!M.value[t])return;const a=["January","February","March","April","May","June","July","August","September","October","November","December"];i.value=new Date(M.value[t].timestamp).getDate()+" "+a[new Date(M.value[t].timestamp).getMonth()]},I=e=>{const t=new Date(e),a=["January","February","March","April","May","June","July","August","September","October","November","December"];return t.getDate()+" "+a[t.getMonth()]+" "+t.getFullYear()},L=e=>{const t=Date.now(),a=new Date(e).getTime(),s=t-a,n=(Math.ceil(s/1e3),new Date(a).getMinutes()),l=new Date(a).getHours();return`${Q(l>12?l-12:l)}:${Q(n)} ${l>=12?"PM":"AM"}`},Q=e=>`${1==String(e).length?"0":""}${String(e)}`;return{msgText:n,getMsgPhotoURL:U,typing:b,debounceSendMsg:q,getTypingUsers:k,unreadChatCount:l,handleProfileShow:Z,socket:o,topMsgDate:i,canShowTopDate:r,getMsgsData:M,scrollArea:c,isOwner:T,sendMsg:j,scrollBottom:H,animateScroll:O,showTopDate:P,onChatMessageIntersection:W,getTimestamp:L,getDatestamp:I,formatNumber:Q,getDate:C}}};var b=a(4260),M=a(4379),k=a(8240),x=a(7030),S=a(7704),_=a(629),C=a(4765),q=a(1007),T=a(9721),U=a(2426),Z=a(5096),j=a(5094),H=a(7518),O=a.n(H);const P=(0,b.Z)(f,[["render",g],["__scopeId","data-v-30558945"]]),W=P;O()(f,"components",{QPage:M.Z,QBtn:k.Z,QChip:x.Z,QScrollArea:S.Z,QChatMessage:_.Z,QSpinnerDots:C.Z,QPageSticky:q.Z,QBadge:T.Z,QInput:U.Z,QAvatar:Z.Z}),O()(f,"directives",{Intersection:j.Z})}}]);